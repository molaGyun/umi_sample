<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ìˆ˜ë°•ê²Œì„ ğŸ‰ (2ë‹¨ê³„ ëœë¤ + ë²ˆê°ˆì´ ìƒ‰ìƒ)</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #d9f9d9;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: "Pretendard", sans-serif;
    }
    #score {
      position: absolute;
      top: 10px;
      left: 20px;
      font-size: 24px;
      color: #333;
      font-weight: bold;
    }
    canvas {
      background: #e8ffe8;
      border: 3px solid #3a3a3a;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <div id="score">ì ìˆ˜: 0</div>
  <canvas id="game"></canvas>

  <script>
    const { Engine, Render, Runner, Bodies, Composite, Events } = Matter;

    const engine = Engine.create();
    const world = engine.world;

    const width = 400, height = 600;
    const canvas = document.getElementById("game");

    const render = Render.create({
      canvas,
      engine,
      options: {
        width,
        height,
        wireframes: false,
        background: "#e8ffe8"
      }
    });

    Render.run(render);
    const runner = Runner.create();
    Runner.run(runner, engine);

    // ë²½, ë°”ë‹¥ ì„¤ì •
    const ground = Bodies.rectangle(width / 2, height, width, 40, { isStatic: true });
    const leftWall = Bodies.rectangle(0, height / 2, 20, height, { isStatic: true });
    const rightWall = Bodies.rectangle(width, height / 2, 20, height, { isStatic: true });
    Composite.add(world, [ground, leftWall, rightWall]);

    // ê³¼ì¼ ì¢…ë¥˜
    const fruitTypes = [
      { color: "#ff9999", r: 15, score: 1 }, // ë¹¨ê°• - ê°€ì¥ ì‘ìŒ
      { color: "#ffcc66", r: 25, score: 2 }, // ë…¸ë‘ - ë‘ ë²ˆì§¸
      { color: "#99ff99", r: 35, score: 4 },
      { color: "#66ccff", r: 50, score: 8 },
      { color: "#ff66cc", r: 70, score: 16 },
      { color: "#33cc33", r: 100, score: 32 } // ìˆ˜ë°•
    ];

    let mouseX = width / 2;
    let score = 0;
    let redTurn = true; // ë¹¨ê°• â†” ë…¸ë‘ ë²ˆê°ˆì´
    let currentFruit = randomFruit();

    // ğŸ”¸ ë¹¨ê°• â†” ë…¸ë‘ ë²ˆê°ˆì´, í¬ê¸°ëŠ” ë‘ ê°€ì§€ ì¤‘ ëœë¤
    function randomFruit() {
      const sizeIndex = Math.random() < 0.5 ? 0 : 1; // 0=ì‘ì€, 1=ì¡°ê¸ˆ í°
      const base = redTurn ? fruitTypes[0] : fruitTypes[1]; // ìƒ‰ìƒ ì„ íƒ
      redTurn = !redTurn; // ë‹¤ìŒ í´ë¦­ì—” ë°˜ëŒ€ìƒ‰
      return { ...base, r: fruitTypes[sizeIndex].r, x: width / 2, y: 50 };
    }

    // ë§ˆìš°ìŠ¤ ì›€ì§ì„ â†’ í˜„ì¬ ê³¼ì¼ ìœ„ì¹˜
    document.addEventListener("mousemove", (e) => {
      const rect = canvas.getBoundingClientRect();
      mouseX = e.clientX - rect.left;
    });

    // í´ë¦­ â†’ ê³¼ì¼ ìƒì„±
    document.addEventListener("click", () => {
      const f = currentFruit;
      const circle = Bodies.circle(mouseX, 60, f.r, {
        restitution: 0.3,
        friction: 0.1,
        render: { fillStyle: f.color }
      });
      circle.fruitData = f;
      Composite.add(world, circle);

      // ë‹¤ìŒ ê³¼ì¼ ì¤€ë¹„
      currentFruit = randomFruit();
    });

    // ê°™ì€ ìƒ‰ìƒë¼ë¦¬ ë¶€ë”ªíˆë©´ í•©ì¹˜ê¸°
    Events.on(engine, "collisionStart", (event) => {
      const pairs = event.pairs;
      for (let pair of pairs) {
        const { bodyA, bodyB } = pair;
        const a = bodyA.fruitData;
        const b = bodyB.fruitData;

        if (a && b && a.color === b.color) {
          const nextIndex = fruitTypes.findIndex(f => f.color === a.color) + 1;
          if (nextIndex < fruitTypes.length) {
            const pos = {
              x: (bodyA.position.x + bodyB.position.x) / 2,
              y: (bodyA.position.y + bodyB.position.y) / 2
            };

            Composite.remove(world, [bodyA, bodyB]);

            const newFruit = fruitTypes[nextIndex];
            const circle = Bodies.circle(pos.x, pos.y, newFruit.r, {
              restitution: 0.3,
              friction: 0.1,
              render: { fillStyle: newFruit.color }
            });
            circle.fruitData = newFruit;
            Composite.add(world, circle);

            score += newFruit.score;
            document.getElementById("score").innerText = `ì ìˆ˜: ${score}`;
          }
        }
      }
    });

    // í˜„ì¬ ê³¼ì¼ ë¯¸ë¦¬ë³´ê¸° (ìœ„ìª½ ë°˜íˆ¬ëª…)
    const ctx = render.context;
    (function drawGuide() {
      requestAnimationFrame(drawGuide);
      ctx.save();
      ctx.fillStyle = currentFruit.color + "88";
      ctx.beginPath();
      ctx.arc(mouseX, 60, currentFruit.r, 0, Math.PI * 2);
      ctx.fill();
      ctx.restore();
    })();
  </script>
</body>
</html>
